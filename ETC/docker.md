# 05-12 일 백엔드 발표 스터디 

#### 주제:도커

## 도커란?
    도커란?

    혹시, Docker에 대해 어렴풋이 들으셨을 수 도 있습니다.배포를 하면서 도커에대해서 들어볼 수있는데, 정작 무엇인지, 왜 쓰는지는 좀 헷갈리시기 마련이다.
    그래서 도커에 대해서 한번 써보았다.

    그럼 도커란 무엇인가? (고래잡이일까요?) 간단히 말해, 로컬에서 잘 작동하는 애플리케이션을 서버로 옮겨 배포할 때 사용하는 마법 같은 도구이다. "왜 필요한가요?"라고 물으신다면, 개발 환경과 서버 환경의 차이 때문이라 그렇습니다.

    예를 한번 들어보면 자바로 뭐 백엔드를 만들었다고 치면 로컬에서는 JDK 17을 쓰고 있었는데, 서버는 JDK 21을 사용하고 있습니다. 여기서 버전 충돌이 발생합니다 ㅜㅜ 또 하나, 우리가 윈도우에서 개발했다면, 대부분의 서버가 리눅스 환경인 것과 충돌이 일어날 수 있어요. 이런 문제들, 정말 짜증 나지 않습니까?

    여기서 도커의 역할이 시작된다고 볼 수 있습니다. 도커는 이러한 환경 차이를 신경 쓸 필요 없이, 어디서든지 똑같이 애플리케이션을 실행할 수 있게 해주는 아주 멋진 도구입니다.이것이 바로 컨테이너화라는 개념이죠. 
    앞서 java를 할때 jvm를 구현한다라고 했는데, jvm도 가상머신 위에 있기때문에 어떤환경에 있더라도 동작합니다.
    도커도 똑같아요.
    애플리케이션과 그것을 실행하는데 필요한 모든 것을 하나의 컨테이너에 담아, 어떤 컴퓨터에서든 동일하게 작동하게 만드는 마법같은 도구입니다.

## 도커의 구조
    도커의 구조는 이미지와 컨테이너로 구성되어있고, 구동되는 파일은 golang으로 되어있다.
    compose.go 라는 파일을 우연치않게 봤는데 간단하게 되어있다.
    암튼 도커 프로그램이 실행하면 이러한 파일들을 찾아 다 구동된다.

## docker를 빌드하는법?
    compose
    이미지 빌드


## 왜쓰냐?
    배포할려는데 버전 환경 다만들어주기보단 그냥 컨테이너 띡올리면 쉽기때문에 쓰는거다.

## 어떻게 쓰는가?
    암튼 어캐함?
    windows 환경이라면 docker windows 를 깔고 시작해야한다.docker가 로컬컴퓨터에 설치되어있어야 하며,

     이를 통해 windows shell을 이용해 docker를 install해주고  docker를 run 해주면 된다.
    예시를 들자면 내가 nginx 웹서버를 도커이미지와 컨테이너를 불러온다면 docker run nginx를 빌드하면되고

    이를 쉘에서 실행하면 도커허브에서 맞는 이미지와 컨테이너를 빌드 해준다.

## 예시


## 이미지와 컨테이너


## 실제 서버 빌드?
    실제 서버 에 빌드할려면 서버에 대한 스냅샷을 찍은 것을 도커허브에 이미지 저장하고 
    이를 run할때 실행해주면된다.
    1.이미지 파일 생성
    2.이미지 파일 도커 허브 푸쉬
    3.도커허브에서 있는 파일을 run

    이는 자바 스프링의 docker 이미지 예시이다.


    ```
    # 사용할 Java 17 베이스 선택 
    FROM openjdk:17

    # 컨테이너 내부에서 작업할 디렉토리 설정
    WORKDIR /app

    # 호스트 시스템에서 컨테이너의 /app 디렉토리로 내가 작업한 JAR 파일 복사
    COPY your-application.jar /app/

    # 컨테이너가 시작될 때 실행될 명령어 설정
    CMD ["java", "-jar", "your-application.jar"]

    ```
    이렇게 하면 된다. 이렇게 하고 aws라고 치면 aws에 ec2서버에 docker 설치하고 
    docker 컨테이너 실행하면 되는 문제이다.

## 도커 컨테이너 해부(docker centos에 db 설치하기)
    이 컨테이너가 어떻게 생겼는지 까보고싶었다. 결론만 말하자면 필요한 패키지만 있는 빈깡통인 상태인 프로그램이라고 
    생각하면 쉽다.

    부트캠프에서 과제를 준건데, centos에 db를 설치하는 법을 알려주겠다.
    일단 centos란 것을 확실히 넘어가보면,

    ### CentOS

    레드햇 엔터프라이즈 리눅스에서 파생된 리눅스의 배포판 중 하나. 2021년 5월 기준 지원중인 버전은 7.9.2009 버전, 8-stream 버전, 9-stream 버전이다.


    유료 배포판이라고 하면 소스 코드가 비공개 또는 제약이 심한 상업용 라이선스 소프트웨어가 포함되었을 거라고 생각하기 쉽지만, RHEL은 정확히 말하면 고객 지원을 제공하는 유료 구독 서비스를 판매하는 유료 배포판이고, RHEL의 소프트웨어 자체는 모두 오픈소스이기 때문에 상표권 문제 정도를 제외하면 가져다가 활용하는 데는 제약이 없다. 바이너리 패키지 업데이트는 구독자에게 제한되어 있지만 소스 패키지는 공개되어 있다. 레드햇 측도 거기에 대해서 일부러 배포를 제한하려고 하지 않으며, 레드햇 본인들이 만든 온갖 각종 소프트웨어도 오픈소스 라이선스로 공개하고 있다. 그러므로 소스 패키지를 빌드하는 것만으로 RHEL과 동일한 배포판 제작이 가능하다.

    한마디로 말하자면 centos도 리눅스에 일종인데,뭔가 레딧 이런데에서 파생된 운영체제이기때문에 지원해주는것이 많이 없긴한데, 네이버나 카카오에서 서버로 자주사용한다.
    왜냐하면 레드햇을 공짜로 사용할수있으니깐?

    ### 특징
    특징은, mysql 대신 mariadb를 사용하는 과정인데,
    mysql 서버를 사용할려고 했는데 외부 입력이 아예 방화벽으로 차단되어있어 내부적으로 설치되어있는 mariadb로 설치했다.

    ### 가설

    가설1 dockerfile
    -->mysql socket 문제

    가설2 블로그 에서 본것
    -->이것도 마찬가지 mysql socket 문제

    가설3 docker 안에 docker did
    -->이것도 마찬가지 mysql socket 문제

    ~~이렇게 공통된 문제로 회귀하였고, 이를 socket(데몬이라고 부름)을 직접 컨테이너에 빌드해야겠다는 마음가짐으로 했다.~~

    그전에 mysql로 세웠다가 가설인데, 다 외부 에서 mysql를 통해 들어와서 설치하기때문에 socker 에러가 났었다.

    ### 과정

    일단 centos 컨테이너를 실행시키는 과정이 필요하다.

    과정은 다음과 같은데,
    1.centos 컨테이너 실행하고 환경에 들간다.
    2.yum 을 통해 sudo와 다른거 설치한다.
    3.maria db를 설치한다.,
    4.maria 서버에 접속한다!

    이렇게 접속하고
    만약에 workbench에 들어가고싶으면 이 1번의 과정을 바꾸면되는데,

    터널링이라는 과정을 거쳐야한다

    docker run -it -p 3310:3306 --name my-centos-mysql-container centos:7 /bin/bash

    이런 과정을 거치고 들어가면된다.

